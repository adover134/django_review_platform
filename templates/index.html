{% load static %}
{% url 'normalUserReviewRead' as normalUserReviewRead %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Rolling Stone Top 500 albums of all time</title>
  <meta name="description" content="Rolling Stone magazine's 2012 list of 500 greatest albums of all time with genres.">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css">
  <link rel="stylesheet" href="{% static 'RowGroup-1.2.0/css/rowGroup.dataTables.css'%}">
  <link rel="stylesheet" href="{% static 'RowGroup-1.2.0/css/rowGroup.bootstrap5.css'%}">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <!-data-ajax에는 "모델 URL/?format=datatables" 형태로 작성하여 어떤 모델에 대한 테이블을 불러올 것인지 설정한다.-->
        <table id="review" class="table table-striped table-bordered" style="width:100%" data-server-side="true" data-ajax="/db/review/?format=datatables">
          <thead>
            <tr>
              <!-data-data는 db에서 field 이름을 넣는다. 이 때, field 이름은 serializer 기준으로 작성한다.-->
              <th data-data="id"></th>
              <th data-data="reviewTitle">리뷰 제목</th>
              <th data-data="reviewWriter">리뷰 작성자</th>
              <th data-data="uEmail">작성자 이메일</th>
              <th data-data="representiveImage">대표 이미지</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
  <script src="//cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
  <script src="{% static 'RowGroup-1.2.0/js/dataTables.rowGroup.js'%}"></script>
  <script src="{% static 'RowGroup-1.2.0/js/rowGroup.bootstrap5.js'%}"></script>
  <script>
      let imageUrl = "{% static 'images/' %}";
      $(document).ready(function() {
          var a = $('#review').DataTable({
            //columnDefs는 column에 대해 안의 데이터가 어떤 식으로 나타나는지를 관리합니다.
            "columnDefs": [
              {
                "targets": 0,
                "visible": false,
              },
              {
                //targets는 몇 번째 열에 대한 것인지를 나타냅니다. target과 동일합니다.
                "targets": 1,
                //여기서는 data를 현재 열에 대한 정보 하나만을 줄 수 있습니다. '하나'에 주의해야 합니다.
                "data": "reviewTitle",
                //render를 통해서 구체적인 출력 내용을 조작합니다.
                //row는 전체 열에 대한 정보를 갖습니다.
                "render": function ( data, type, row, meta ) {
                  return '<a href="{{normalUserReviewRead}}?id='+row.id+'">'+data+'</a>';
                }
              },
              {
                "targets": 4,
                "data": "representiveImage",
                "render": function ( data, type, row, meta ) {
                  if (data !== null)
                    return '<img src="'+imageUrl+data+'">';
                  else
                    return '';
                }
              }
            ],
            "order":[[0, "asc"]],
            rowGroup: {
              dataSrc: 'id',
              startRender: function (rows, group ) {
                console.log(rows.header);
                return group;
              },
            }
          });
          console.log(a.columns().header());
      });
  </script>
</body>
</html>