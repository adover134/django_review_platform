{% extends 'normal_user_base.html' %}
{% load index static %}

{% block main_contents %}
{% if request.path != infoCheck %}
<meta http-equiv="refresh" content="0; url='{{infoCheck}}'">
{% else %}
<script>
    window.onpageshow = function(event) {
        if (event.persisted) {
            document.location.reload();
        }
    };
</script>
{% endif %}
<link rel="stylesheet" href="{% static 'css/normalUserInfoCheckTemplate.css' %}">
<div id="infoCheckAndUpdate">
    <!-정보 확인 및 수정을 위한 공간 / 폼을 통해 정보 확인 및 갱신-->
    <form method="POST" enctype="multipart/form-data" action="/change_user_info/" onsubmit="get_layout()">
        {% csrf_token %}
        <div style ="overflow:hidden; font-weight:600;font-size:50px;width:80%; display: inline-block;">{# 닉네임은 성,이름으로 대체 #}
            <input name="last_name"  type="text" value="{{ user.last_name }}" style="border:none;font-weight:600;font-size:50px;width:10%;"> <input name="first_name" type="text" value="{{ user.first_name }}" style="border:none;font-weight:1000;font-size:50px;width:20%;">   님
        </div>
        <div style="position:relative;display:inline-block; top:2vh; right:3.7%;float:right;">
            <button type="button">회원 탈퇴</button>
        </div>
        <div id ="info">
        <div style = "display: inline-block;">
            {{ user.email }}
        </div>
        <div id = "retouch" >
            <a style ="text-decoration: none; color:darkred;" href="javascript:(0)" onclick="document.getElementById('search_filter').submit();">수정</a>
        </div>
        <div>
            마지막 로그인 일시 {{ user.last_login }}
        </div>
        <div>
            가입일 {{ user.date_joined }}
        </div>
        <div>
            활동 상태 {{ user|check_active }}
        </div>
        <div>
            경고 횟수 {{ user.uWarnCount }}회
        </div>
        </div>
    </form>
</div>

<div id="reviews_div">
    <div id="util" style="display:block;">
        <div style="display:flex; justify-content: right; margin: 1.7% 6.25% auto auto;">
            <div style="display: inline-block;padding-right: 2%;">
                <select id="sort_select_box" name="sort_select_box" onchange="sort()">
                    <option value="1">최신 순</option>
                    {#            현재 주소에서 &sorted=1 파라미터 붙을때#}
                    {#            ex) http://127.0.0.1:8000/room_with_reviews_display/?roomId=1&sorted=1 #}
                    <option value="2">추천 순</option>
                    {#            현재 주소에서 &sorted=2 파라미터 붙을때#}
                    {#            ex) http://127.0.0.1:8000/room_with_reviews_display/?roomId=1&sorted=2 #}
                    <option value="3">정확도 순</option>
                    {#            현재 주소에서 &sorted=3 파라미터 붙을때#}
                    {#            ex) http://127.0.0.1:8000/room_with_reviews_display/?roomId=1&sorted=3 #}
                </select>
            </div>
            <div>
                <button onclick="location.href='/normal_user_review_write_page'"
                        style=" cursor: pointer;  background-color: white;">리뷰 작성</button>
            </div>
        </div>
    </div>
    <div id="reviews" style="display:block;">
        {% for review in reviews %}
            <div style="border: 3px; margin: 1.86% 6.25% 1.86% 6.25%; line-height: 2.8vh;height: 20vh;" >
                <div style= "background-color:#0dcaf0;height: 68.4%; width :15.2%; display:inline-block; float:left;">
                    {% if review.additionalImage %}
                        <img style= "height:100%; width :100%;" class="left-side-room-img" src="{% static 'images/' %}{{review.additionalImage|first}}">
                    {% endif %}
                </div>
                <span style="font-weight:600;font-size: 23px; line-height: 5vh;">&ensp;
        {#                리뷰 제목 #}
                        최신 리뷰 제목 -> {{ review.reviewTitle }}</span>
                <span style = "float : right; padding-top: 1%;">
        {#            추천 수 데이터 #}
                    추천 수 {{ review.recommendedOn|length }}</span>
                <div style = "color: #ECECEC; padding-left: 16%;">&ensp;
        {#            리뷰 내용 데이터 #}
                      리뷰내용 -> {{ review.reviewSentence }}</div>
                <span style = " letter-spacing : 1vw; position: relative; right:2.5%;">&ensp;
        {#            리뷰별 아이콘 데이터 목록 #}
                    {% if review.includedIcon %}
                        {% for icon in review.includedIcon %}
                            <img src="{% static 'images/iconImage/' %}{{ icon }}">
                        {% endfor %}
                    {% endif %}
                </span>
            </div>
        {% endfor %}
    </div>
</div>
<script>
    function sort(){
        let selected = document.getElementById('sort_select_box');
        let a = window.location.href;
        let b = a.indexOf('sorted');
        window.location.href = a.slice(0, b)+'sorted='+document.getElementById('sort_select_box').value;
    }
    window.onload=function() {
        let a = new URLSearchParams(window.location.search).get('sorted');
        var b = document.createElement("option");
        switch (a) {
            case '2':
                b.innerText = '추천 순';
                break;
            case '3':
                b.innerText = '정확도 순';
                break;
            case '1':
            default:
                b.innerText = '최신 순';
                break;
        }
        b.selected = true;
        b.style.display = 'none';
        document.getElementById('sort_select_box').appendChild(b);
    }
</script>
<script  src="{% static 'js/normalUserInfoCheckTemplate.js' %}"></script>
{% endblock %}
