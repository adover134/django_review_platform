{% extends 'normal_user_base.html' %}
{% load static %}
{% url 'user-detail' pk=u_id as singleUser %}

{% block main_contents %}
    <link rel="stylesheet" href="{% static 'css/normalUserReviewWriteTemplate.css' %}">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <div id="icons" style="position:relative; display:none; float:left; height:500px; width:200px; border:1px solid green;"></div>
    <div style="width: 100%; height: 100%;">
        <form id="text_review" action="#" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div id="tr1">
                <div style="background-color: #A23355 ; color: white; height:100%; width: 10.61% ;
                        text-align: center; margin: 0 auto" id="review_address">주소</div>
                <input id="id_address" style="float: right; border-color: #A23355;
                        flex:1" name="address" required>
                <script>
                    let a = (document.getElementById('room_search_filter').offsetHeight/16).toString()+'rem';
                    document.getElementById('room_search_filter').style.fontSize=a;
                </script>
            </div>
            <div id="tr2">
                <div style="height: 9.09%; width: 100%; ">
                    <input style="height:100%;width: 100%; text-align: left; border-color: #B3B3B3" name="title"
                           placeholder="제목을 입력하세요">
                </div>
                <div style="height: 58.7%; padding-top: 2.604%">
                    <input style="height: 100%; width: 100%; text-align:left; border-color: #B3B3B3" name="review_sentence"
                           placeholder="리뷰 본문을 입력하세요">
                </div>
                <div style="padding-top: 3.038%">
                    <ul class="image-preview"></ul> {# 업로드한 이미지 띄우는 부분 #}
                    <div style="float: right">
                        <input type="file" class="real-upload" accept="image/*" multiple id="images" name="images">
                        <input value="리뷰 등록" type="submit" style="background-color: #A4A1A1; border-color:#888888;
                        color: white">
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        // 이미지 업로드
        function getImageFiles(e){
            const uploadFiles = [];
            const files = e.currentTarget.files;
            const imagePreview = document.querySelector('.image-preview');

            [...files].forEach(file => {
                uploadFiles.push(file);

                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = createElement(e, file);
                    imagePreview.appendChild(preview);
                };

              reader.readAsDataURL(file);
            });
        }

        function createElement(e, file) {
          const li = document.createElement('li');
          const img = document.createElement('img');
          img.setAttribute('src', e.target.result);
          img.setAttribute('data-file', file.name);
          li.appendChild(img);

          return li;
        }

        const realUpload = document.querySelector('.real-upload');
        realUpload.addEventListener('change', getImageFiles);

    </script>
    <script type="text/javascript" src="{% static 'js/normalUserReviewWriteTemplate.js' %}"></script>
{% endblock %}
